<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding favicon -->
    

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      querys/querysTecnicos.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="6527627" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="module-ADMIN_CONTROLLER.html">ADMIN_CONTROLLER</a></li><li class="accordion collapsed child" id=909085><div class="accordion-heading child"><a href="module-API-MW.html">API-MW</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-API-MW.html#~apiMW">apiMW</a></li></ul></li><li class="accordion-list" id=""><a href="module-AUTH_CONTROLLER.html">AUTH_CONTROLLER</a></li><li class="accordion collapsed child" id=4297212><div class="accordion-heading child"><a href="module-CONSULTAS_BD_TECNICOS.html">CONSULTAS_BD_TECNICOS</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~AddBinnacle">AddBinnacle</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~AddComment">AddComment</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~AddPerson">AddPerson</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~addPersonBD">addPersonBD</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~AddService">AddService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~AddTechnicalService">AddTechnicalService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~DeleteTechnicaltoService">DeleteTechnicaltoService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~ExistEployeeNumber">ExistEployeeNumber</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~ExistTechnicalInService">ExistTechnicalInService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetActiveServices">GetActiveServices</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetDisponibleTechnical">GetDisponibleTechnical</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetEnterprices">GetEnterprices</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetIndexService">GetIndexService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetPersonGeneral">GetPersonGeneral</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetPersons">GetPersons</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetRoles">GetRoles</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetService">GetService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetServices">GetServices</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetTechnicalInService">GetTechnicalInService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetTechnicalsInServiceActive">GetTechnicalsInServiceActive</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~GetTypes">GetTypes</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~UpdatePerson">UpdatePerson</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~UpdateService">UpdateService</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~UpdateTechnical">UpdateTechnical</a></li><li data-type='method'><a href="module-CONSULTAS_BD_TECNICOS.html#~UserAccess">UserAccess</a></li></ul></li><li class="accordion-list" id=""><a href="module-CONSULTAS_SISTEMA_MONITORING-WORKS.html">CONSULTAS_SISTEMA_MONITORING-WORKS</a></li><li class="accordion-list" id=""><a href="module-ERROR_CONTROLLER.html">ERROR_CONTROLLER</a></li><li class="accordion collapsed child" id=4790928><div class="accordion-heading child"><a href="module-FILES.html">FILES</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-FILES.html#~createFolder">createFolder</a></li><li data-type='method'><a href="module-FILES.html#~deleteDirectory">deleteDirectory</a></li><li data-type='method'><a href="module-FILES.html#~deleteFile">deleteFile</a></li><li data-type='method'><a href="module-FILES.html#~existDirectory">existDirectory</a></li><li data-type='method'><a href="module-FILES.html#~getFiles">getFiles</a></li><li data-type='method'><a href="module-FILES.html#~upLoadFile">upLoadFile</a></li></ul></li><li class="accordion-list" id=""><a href="module-FILES_CONTROLLER.html">FILES_CONTROLLER</a></li><li class="accordion collapsed child" id=6419051><div class="accordion-heading child"><a href="module-FUNCTIONS.html">FUNCTIONS</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-FUNCTIONS.html#~DecriptRot39">DecriptRot39</a></li><li data-type='method'><a href="module-FUNCTIONS.html#~EncriptRot39">EncriptRot39</a></li><li data-type='method'><a href="module-FUNCTIONS.html#~esLetra">esLetra</a></li><li data-type='method'><a href="module-FUNCTIONS.html#~esNumero">esNumero</a></li><li data-type='method'><a href="module-FUNCTIONS.html#~getDate">getDate</a></li><li data-type='method'><a href="module-FUNCTIONS.html#~getEnterpriceOfTechnicals">getEnterpriceOfTechnicals</a></li><li data-type='method'><a href="module-FUNCTIONS.html#~modDate">modDate</a></li></ul></li><li class="accordion collapsed child" id=7256730><div class="accordion-heading child"><a href="module-GENERAR_JWT.html">GENERAR_JWT</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-GENERAR_JWT.html#~decodeJWT">decodeJWT</a></li><li data-type='method'><a href="module-GENERAR_JWT.html#~generarJWT">generarJWT</a></li></ul></li><li class="accordion collapsed child" id=6606769><div class="accordion-heading child"><a href="module-HELPERS_DB_VALIDACIONES.html">HELPERS_DB_VALIDACIONES</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~existEmail">existEmail</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~existEnterprice">existEnterprice</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~ExistPersonInDB">ExistPersonInDB</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~existRole">existRole</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~existRoleinDB">existRoleinDB</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~existTechnicals">existTechnicals</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~existTypeService">existTypeService</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~isDate">isDate</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~validateOptionUpdateEnterprice">validateOptionUpdateEnterprice</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~validateOptionUpdatePerson">validateOptionUpdatePerson</a></li><li data-type='method'><a href="module-HELPERS_DB_VALIDACIONES.html#~validEnterprice">validEnterprice</a></li></ul></li></ul> </div><div class="accordion collapsed" id="3972226" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=8923393><div class="accordion-heading child"><a href="Server.html">Server</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Server.html#connectDB">connectDB</a></li><li data-type='method'><a href="Server.html#listen">listen</a></li><li data-type='method'><a href="Server.html#middlewares">middlewares</a></li><li data-type='method'><a href="Server.html#routes">routes</a></li></ul></li><li class="accordion collapsed child" id=5038743><div class="accordion-heading child"><a href="Task.html">Task</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Task.html#add">add</a></li><li data-type='method'><a href="Task.html#delete">delete</a></li><li data-type='method'><a href="Task.html#deleteTaskifNotExist">deleteTaskifNotExist</a></li><li data-type='method'><a href="Task.html#getCrons">getCrons</a></li><li data-type='method'><a href="Task.html#getTask">getTask</a></li><li data-type='method'><a href="Task.html#stop">stop</a></li><li data-type='method'><a href="Task.html#update">update</a></li></ul></li></ul> </div><div class="accordion collapsed" id="2623900" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html">addService</a></li><li class="accordion-list" id=""><a href="global.html#Body">Body</a></li><li class="accordion-list" id=""><a href="global.html#date">date</a></li><li class="accordion-list" id=""><a href="global.html#FormatDate">FormatDate</a></li><li class="accordion-list" id=""><a href="global.html">getAccountsMW</a></li><li class="accordion-list" id=""><a href="global.html">getActiveServices</a></li><li class="accordion-list" id=""><a href="global.html">getDisponibleTechnicals</a></li><li class="accordion-list" id=""><a href="global.html">getEvents</a></li><li class="accordion-list" id=""><a href="global.html">getInServiceTechnicals</a></li><li class="accordion-list" id=""><a href="global.html">getPersons</a></li><li class="accordion-list" id=""><a href="global.html">getServiceDetails</a></li><li class="accordion-list" id=""><a href="global.html">getServices</a></li><li class="accordion-list" id=""><a href="global.html">getTask</a></li><li class="accordion-list" id=""><a href="global.html">getVersionApp</a></li><li class="accordion-list" id=""><a href="global.html">modTechnicalToAService</a></li><li class="accordion-list" id=""><a href="global.html#PropsAddBinnacle">PropsAddBinnacle</a></li><li class="accordion-list" id=""><a href="global.html#PropsAddPerson">PropsAddPerson</a></li><li class="accordion-list" id=""><a href="global.html#PropsAddService">PropsAddService</a></li><li class="accordion-list" id=""><a href="global.html#RespUserAccess">RespUserAccess</a></li><li class="accordion-list" id=""><a href="global.html#time">time</a></li><li class="accordion-list" id=""><a href="global.html">updateService</a></li><li class="accordion-list" id=""><a href="global.html">updateTask</a></li><li class="accordion-list" id=""><a href="global.html#validarCampos">validarCampos</a></li><li class="accordion-list" id=""><a href="global.html#validarJWT">validarJWT</a></li><li class="accordion-list" id=""><a href="global.html">verifyEventsService</a></li><li class="accordion-list" id=""><a href="global.html">verifyPassword</a></li></ul> </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        querys/querysTecnicos.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
var __awaiter = (this &amp;&amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __rest = (this &amp;&amp; this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) &amp;&amp; e.indexOf(p) &lt; 0)
        t[p] = s[p];
    if (s != null &amp;&amp; typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i &lt; p.length; i++) {
            if (e.indexOf(p[i]) &lt; 0 &amp;&amp; Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.GetService = exports.GetServices = exports.UpdatePerson = exports.UpdateTechnical = exports.UpdateService = exports.GetTechnicalInService = exports.GetActiveServices = exports.ExistTechnicalInService = exports.GetTechnicalsInServiceActive = exports.GetTypes = exports.GetDisponibleTechnical = exports.GetIndexService = exports.GetRoles = exports.GetPersonGeneral = exports.GetPersons = exports.GetEnterprices = exports.ExistEployeeNumber = exports.DeleteTechnicaltoService = exports.addPersonBD = exports.AddTechnicalService = exports.UserAccess = exports.AddService = exports.AddBinnacle = exports.AddComment = exports.AddPerson = void 0;
const mssql_1 = require("mssql");
const app_1 = require("../../app");
const uuid_1 = require("uuid");
const connection_1 = require("../db/connection");
/**
 * @typedef {Object} PropsAddPerson
 * @property {string} id_person id único
 * @property {number} id_enterprice id de empresa
 * @property {number} id_role id rol que desempeña
 * @property {string} name Nombre de la persona
 * @property {string} lastname Apellidos de la persona
 * @property {string | null} email Correo
 * @property {string} password Contraseña
 * @property {string | null} phoneNumber Número telefónico
 * @property {string} employeeNumber Número de empleado
 */
/**
 * @typedef {Object} PropsAddBinnacle
 * @property {string} id_service id único
 * @property {string} zones JSON convertido a string
 * @property {string} missingZones JSON convertido a string
 * @property {string} zonesUndefined JSON convertido a string
 * @property {string} users JSON convertido a string
 * @property {string} missingUsers JSON convertido a string
 * @property {string} usersUndefined JSON convertido a string
 * @property {string} link Estado del enlace
 * @property {string} technicals Arreglo convertido a string
 */
/**
 * @typedef {Object} PropsAddService
 * @property {string} id_service
 * @property {string} grantedEntry
 * @property {number} id_type
 * @property {string} folio
 * @property {Date} entryDate
 * @property {Date} exitDate
 * @property {string} accountMW
 * @property {string} digital
 * @property {string} nameAccount
 * @property {boolean} isKeyCode
 * @property {boolean} isOpCi
 * @property {string} cron
 */
/**
 * @typedef {Object} Body
 */
/**
 * @typedef {Object} RespUserAccess
 * @property {Object&lt;{status:number, msg:string}>} [error] Si se hubo algún error
 * @property {boolean} [isExist] si existe el usuario mandado
 * @property {boolean} [isPersonHaveUser] si el usuario mandado le pertenece a la persona ingresada
 * @property {boolean} [isInserted] si la persona inserto un dato correctamente
 * @property {boolean} [isUpdated] si  los datos de la persona fuerpn actuaizados correctamente
 * @property {boolean} [isDeleted] si la persona fue eliminada correctamente
 */
/**@module CONSULTAS_BD_TECNICOS */
/**
 * Agrega una persona a la base de datos
 * @param {PropsAddPerson} data
 * @returns {Promise&lt;{ isInserted: boolean} | { isInserted: boolean, error: string }>}
 */
const AddPerson = (data) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_person', mssql_1.TYPES.VarChar(40), data.id_person)
        .input('id_enterprice', mssql_1.TYPES.SmallInt, data.id_enterprice)
        .input('id_role', mssql_1.TYPES.SmallInt, data.id_role)
        .input('name', mssql_1.TYPES.VarChar(30), data.name)
        .input('lastname', mssql_1.TYPES.VarChar(50), data.lastname)
        .input('email', mssql_1.TYPES.VarChar(50), data.email)
        .input('password', mssql_1.TYPES.Text, data.password)
        .input('phoneNumber', mssql_1.TYPES.VarChar(10), data.phoneNumber)
        .input('employeeNumber', mssql_1.TYPES.VarChar(20), data.employeeNumber)
        .query(`
            INSERT INTO Person 
                (id_person ,id_enterprice ,id_role ,name ,lastname ,email ,password ,phoneNumber ,employeeNumber)
            VALUES  
                (@id_person ,@id_enterprice ,@id_role ,@name ,@lastname ,@email ,@password ,@phoneNumber ,@employeeNumber)
            `)
        .then(() => {
        return { isInserted: true };
    })
        .catch(err => {
        return { isInserted: false, error: `${err}` };
    });
});
exports.AddPerson = AddPerson;
/**
 * Agrega un comentario a un servicio
 * @param {Object&lt;{id_service: string, person: string, comment: string}>} data Datos del comentario
 * @returns { Promise&lt;{ isInserted: boolean } | {isInserted: boolean, error: string }> }
 */
const AddComment = (data) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), data.id_service)
        .input('person', mssql_1.TYPES.Text, data.person)
        .input('comment', mssql_1.TYPES.Text, data.comment)
        .query(`
            INSERT INTO Comment 
                (id_service,person ,comment)
            VALUES  
                (@id_service,@person ,@comment)
            `)
        .then(() => {
        return { isInserted: true };
    })
        .catch(err => {
        return { isInserted: false, error: `${err}` };
    });
});
exports.AddComment = AddComment;
/**
 * Agrega la bitácora del servicio cuando ya se ha liberado
 * @param {PropsAddBinnacle} data Datos de la bitácora
 * @returns {Promise&lt;{ isInserted: boolean} | { isInserted: boolean, error: string }>}
 */
const AddBinnacle = (data) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), data.id_service)
        .input('zones', mssql_1.TYPES.Text, data.zones)
        .input('missingZones', mssql_1.TYPES.Text, data.missingZones)
        .input('zonesUndefined', mssql_1.TYPES.Text, data.zonesUndefined)
        .input('users', mssql_1.TYPES.Text, data.users)
        .input('missingUsers', mssql_1.TYPES.Text, data.missingUsers)
        .input('usersUndefined', mssql_1.TYPES.Text, data.usersUndefined)
        .input('link', mssql_1.TYPES.VarChar(20), data.link)
        .input('technicals', mssql_1.TYPES.Text, data.technicals)
        .query(`
                INSERT INTO Binnacle 
                    (id_service,zones,missingZones,zonesUndefined,users,missingUsers,usersUndefined,link,technicals)
                VALUES  
                    (@id_service,@zones,@missingZones,@zonesUndefined,@users,@missingUsers,@usersUndefined,@link,@technicals)
            `)
        .then(() => {
        return { isInserted: true };
    })
        .catch(err => {
        return { isInserted: false, error: `${err}` };
    });
});
exports.AddBinnacle = AddBinnacle;
/**
 * Agrega un nuevo servicio
 * @param {PropsAddService} data
 * @returns {Promise&lt;{ isInserted: boolean} | { isInserted: boolean, error: string }>}
 */
const AddService = (data) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), data.id_service)
        .input('grantedEntry', mssql_1.TYPES.Text, data.grantedEntry)
        .input('id_type', mssql_1.TYPES.Numeric, data.id_type)
        .input('folio', mssql_1.TYPES.VarChar(50), data.folio)
        .input('entryDate', mssql_1.TYPES.DateTime, data.entryDate)
        .input('exitDate', mssql_1.TYPES.DateTime, data.exitDate)
        .input('accountMW', mssql_1.TYPES.VarChar, data.accountMW)
        .input('digital', mssql_1.TYPES.VarChar(10), data.digital)
        .input('nameAccount', mssql_1.TYPES.VarChar(100), data.nameAccount)
        .input('isKeyCode', mssql_1.TYPES.Bit, data.isKeyCode)
        .input('isOpCi', mssql_1.TYPES.Bit, data.isOpCi)
        .input('cron', mssql_1.TYPES.VarChar(20), data.cron)
        .query(`
                INSERT INTO Service
                    (id_service, grantedEntry, id_type, folio, entryDate, exitDate, accountMW, isKeyCode, isOpCi, cron, digital, nameAccount)
                VALUES
                    ( @id_service, @grantedEntry, @id_type, @folio, @entryDate, @exitDate, @accountMW, @isKeyCode, @isOpCi, @cron, @digital, @nameAccount)
            `)
        .then(() => __awaiter(void 0, void 0, void 0, function* () {
        var _a;
        (_a = app_1.server.Task) === null || _a === void 0 ? void 0 : _a.add(data.id_service, data.cron, false);
        return { isInserted: true };
    }))
        .catch(err => {
        return { isInserted: false, error: `${err}` };
    });
});
exports.AddService = AddService;
/**
 * Proceso que hace la verifiación de usuarios registrados al momento de actualizar alguna persona, eliminacion de una persona y actualización de datos de la persona
 * @param {Object} props { id_user: string | null; insert?: { nameUser: string; }; deleteUser?: boolean; update?: { nameUser: string; }; exist?: { nameUser: string; id_role?: number; }; existWithoutThisPerson?: { nameUser: string; }; personHaveUser?: { nameUser: string; }; }
 * @returns {Promise&lt;RespUserAccess>}
 */
const UserAccess = (props) => __awaiter(void 0, void 0, void 0, function* () {
    if (Object.keys(props).length > 2)
        return { error: { status: 400, msg: `Propiedades invalidas ${Object.keys(props)}` } };
    const { id_user, deleteUser, exist, existWithoutThisPerson, insert, update, personHaveUser } = props;
    if (exist) {
        const { rowsAffected } = yield connection_1.pool1.request().query(`select * from UserAccess where nameUser COLLATE SQL_Latin1_General_CP1_CS_AS = '${exist.nameUser}'`);
        if (rowsAffected[0] !== 0)
            return { error: { status: 400, msg: (exist.id_role === 2) ? `El usuario de monitorista: ${exist.nameUser} ya existe` : `El usuario: ${exist.nameUser} ya existe` } };
        return { isExist: false };
    }
    if (existWithoutThisPerson) {
        const { rowsAffected: existUser } = yield connection_1.pool1.request()
            .input('id_user', mssql_1.TYPES.VarChar(40), id_user)
            .query(`select id_user from UserAccess where nameUser COLLATE SQL_Latin1_General_CP1_CS_AS = '${existWithoutThisPerson.nameUser}' and id_user != @id_user`);
        if (existUser[0] !== 0)
            return { error: { status: 400, msg: `El usuario:${existWithoutThisPerson.nameUser} ya existe` } };
        return { isExist: false }; //false significa que no existe el usuario
    }
    if (personHaveUser) {
        const { rowsAffected: isPersonHaveUser } = yield connection_1.pool1.request()
            .input('id_user', mssql_1.TYPES.VarChar(40), id_user)
            .query(`select id_user from UserAccess where id_user = @id_user`);
        if (isPersonHaveUser[0] === 0)
            return { isPersonHaveUser: false }; //No tiene usuario enUsers
        else
            return { isPersonHaveUser: true }; //Tiene usuario en users
    }
    if (insert) {
        const isInserted = yield connection_1.pool1.request()
            .input('id_user', mssql_1.TYPES.VarChar(40), id_user)
            .input('nameUser', mssql_1.TYPES.VarChar(20), insert.nameUser)
            .query(`INSERT INTO UserAccess (id_user,nameUser) VALUES (@id_user,@nameUser)`)
            .then(() => true)
            .catch(err => `${err}`);
        if (typeof (isInserted) === 'string')
            return { error: { status: 500, msg: isInserted } };
        return { isInserted };
    }
    if (update) {
        const isUpdated = yield connection_1.pool1.request()
            .input('id_user', mssql_1.TYPES.VarChar(40), id_user)
            .input('nameUser', mssql_1.TYPES.VarChar(20), update.nameUser)
            .query(`Update UserAccess set nameUser = @nameUser where id_user=@id_user`)
            .then(() => true)
            .catch(err => `${err}`);
        if (typeof (isUpdated) === 'string')
            return { error: { status: 500, msg: isUpdated } };
        return { isUpdated };
    }
    if (deleteUser) {
        const isDeleted = yield connection_1.pool1.request()
            .input('id_user', mssql_1.TYPES.VarChar(40), id_user)
            .query('delete UserAccess where id_user=@id_user').then(() => true)
            .catch(err => `${err}`);
        if (typeof (isDeleted) === 'string')
            return { error: { status: 500, msg: isDeleted } };
        return { isDeleted };
    }
});
exports.UserAccess = UserAccess;
/**
 * Proceso que agrega un técnico a un servicio activo
 * @param {String} id_service id del servicio. (Debe ser un servicio activo )
 * @param {String} id_technical id del técnico. (Debe ser un técnico disponible; no asignado a un servicio).
 * @returns {Promise&lt;{ isInserted: boolean } | { isInserted: boolean, error: string }>}
 */
const AddTechnicalService = (id_service, id_technical) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), id_service)
        .input('id_technical', mssql_1.TYPES.VarChar(40), id_technical)
        .query(`INSERT INTO TechnicalService ( id_service, id_technical ) VALUES ( @id_service, @id_technical )`)
        .then(() => {
        return { isInserted: true };
    })
        .catch(err => {
        return { isInserted: false, error: `${err}` };
    });
});
exports.AddTechnicalService = AddTechnicalService;
/**
 * Agrega una persona a la base de datos
 * @param {Object&lt;{  name: string, lastname: string, email: string | null, password: string, phoneNumber: string | null, employeeNumber: string, enterprice: Object&lt;{ id: number, shortName: string }>, role: Object&lt;{ id: number, name: string, user: string }> }>} person
 * @returns {Promise&lt;{ error: { status: number, msg: string }, isInserted: undefined } | { isInserted: { status: number }, error: undefined }>}
 */
const addPersonBD = (person) => __awaiter(void 0, void 0, void 0, function* () {
    const id_person = (0, uuid_1.v4)();
    const exist = yield (0, exports.GetPersonGeneral)({ id: id_person });
    const { enterprice, role, email, phoneNumber } = person, rest = __rest(person, ["enterprice", "role", "email", "phoneNumber"]);
    if (typeof (exist) === 'string')
        return { error: { status: 500, msg: exist } };
    if (exist === undefined) {
        const existEN = yield (0, exports.ExistEployeeNumber)({ id_enterprice: enterprice.id, employeeNumber: rest.employeeNumber });
        if (typeof (existEN) === 'string')
            return { error: { status: 500, msg: `${existEN}` } };
        if (existEN)
            return { error: { status: 400, msg: `El Codigo de empleado: ${rest.employeeNumber} ya existe` } };
        const obj = Object.assign({ id_person, email: (email === '') ? null : email, phoneNumber: (phoneNumber === '') ? null : phoneNumber, id_enterprice: enterprice.id, id_role: role.id }, rest);
        const { isInserted, error } = yield (0, exports.AddPerson)(Object.assign({}, obj));
        if (isInserted) {
            if (person.role.id === 2 || email === '') {
                // const { isInserted, error }: RespInsert = await AddUserAccess(id_person, person.role.user);
                const isInserted = yield (0, exports.UserAccess)({ id_user: id_person, insert: { nameUser: person.role.user } });
                if (isInserted === null || isInserted === void 0 ? void 0 : isInserted.error) {
                    yield connection_1.pool1.request().query(`delete Person where id_person = '${id_person}'`);
                    return { error: { status: 400, msg: `Error al insertar AddUserAccess Error: ${error}` } };
                }
                return { isInserted: { status: 200 } };
            }
            else
                return { isInserted: { status: 200 } };
        }
        else
            return { error: { status: 400, msg: `Error al insertar la persona Error: ${error}` } };
    }
    else
        return { error: { status: 400, msg: `Error al generar identificador unico Intente de nuevo` } };
});
exports.addPersonBD = addPersonBD;
/**
 * Elimina un técnico de un servicio activo activo
 * @param {String} id_service id del servicio
 * @param {String} id_technical id del técnico
 * @returns {Promise&lt;string | boolean>}
 */
const DeleteTechnicaltoService = (id_service, id_technical) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), id_service)
        .input('id_technical', mssql_1.TYPES.VarChar(40), id_technical)
        .query(`delete TechnicalService where id_service=@id_service and id_technical=@id_technical`)
        .then(() => true)
        .catch(err => ` ${err}`);
});
exports.DeleteTechnicaltoService = DeleteTechnicaltoService;
/**
 * Verifica si existe el número de empleado
 * @param {Object&lt;{id_enterprice: number, employeeNumber: string, personExclude: string| undefined }>} param0
 * @returns {Promise&lt;string | boolean>}
 */
const ExistEployeeNumber = ({ employeeNumber, id_enterprice, personExclude }) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        //true: existe el numero de empleado para esa empresa
        //false: no existe el numero de empleado para esa empresa
        const { rowsAffected } = yield connection_1.pool1.request()
            .input('id_enterprice', mssql_1.TYPES.SmallInt, id_enterprice)
            .input('employeeNumber', mssql_1.TYPES.VarChar(10), employeeNumber)
            .query(`select * from Person where id_enterprice = @id_enterprice and employeeNumber = @employeeNumber ${personExclude ? `and id_person != '${personExclude}'` : ''}`);
        return (rowsAffected[0] !== 0) ? true : false;
    }
    catch (error) {
        return `${error}`;
    }
});
exports.ExistEployeeNumber = ExistEployeeNumber;
/**
 * Obtiene todas o una empresa
 * @param {Object&lt;{enterprice: Object&lt;{ id_enterprice:number, shortName:string}>| undefined, shortName: string| undefined}>} param0
 * @returns {Promise&lt;string | IRecordSet&lt;any>>}
 */
const GetEnterprices = ({ enterprice, shortName }) => __awaiter(void 0, void 0, void 0, function* () {
    if (shortName &amp;&amp; enterprice)
        return `Solo se debe mandar una opción de busqueda`;
    let query = (enterprice) ? `select * from Enterprice ${enterprice ? `where id_enterprice=${enterprice.id_enterprice} and shortName='${enterprice.shortName}'` : ''}` :
        (shortName) ? `select * from Enterprice where shortName='${shortName}'` :
            'select * from Enterprice';
    try {
        const { recordset: Enterprices } = yield connection_1.pool1.request().query(query);
        return Enterprices;
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetEnterprices = GetEnterprices;
/**
 * Obtiene las personas registradas en la base de datos por rol o todos: 850827
 * @param {number} role 1:Técnicos, 2:Monitoristas, 3:Encargados de técnicos, 850827: Todos
 * @param {boolean| undefined} isActive si queremos que se encuentren solo los activos: true de lo contrario: false,
 * @returns {Promise&lt;string | IRecordSet&lt;Person>>}
 */
const GetPersons = (role, isActive) => __awaiter(void 0, void 0, void 0, function* () {
    let query = '';
    if (role === 850827) {
        query =
            `
                select P.id_person, E.id_enterprice,P.id_role,E.shortName as enterpriceShortName,P.name as personName,P.lastname,P.email,p.phoneNumber,P.employeeNumber,P.status, UA.nameUser 
                from Person P
                left join Enterprice E on P.id_enterprice= E.id_enterprice
                left join UserAccess UA on UA.id_user=P.id_person
            `;
    }
    else {
        query =
            `
                select P.id_person, E.id_enterprice,P.id_role,E.shortName as enterpriceShortName,P.name as personName,P.lastname,P.email,p.phoneNumber,P.employeeNumber,P.status, UA.nameUser 
                from Person P
                left join Enterprice E on P.id_enterprice= E.id_enterprice
                left join UserAccess UA on UA.id_user=P.id_person
                where id_role = ${role} ${(isActive) ? `and P.status='ACTIVO'` : ''}
            `;
    }
    try {
        const { recordset: Persons } = yield connection_1.pool1.request().query(query);
        return Persons;
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetPersons = GetPersons;
/**
 * Obtiene los datos generales de una persona
 * @param { Object&lt;{ id: string| undefined, role: number| undefined, email: string| undefined, user: string| undefined, inactive: 'INACTIVO'| undefined }>} param0
 * @returns {Promise&lt;string | Person>}
 */
const GetPersonGeneral = ({ id, role, email, user, inactive }) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const { recordset: Person } = yield connection_1.pool1.request().query(`
                select P.id_person, E.id_enterprice,P.id_role,E.shortName as enterpriceShortName,P.name as personName,P.lastname,P.email,P.password,p.phoneNumber,P.employeeNumber,P.status, UA.nameUser 
                from Person P
                left join Enterprice E on P.id_enterprice= E.id_enterprice
                left join UserAccess UA on UA.id_user=P.id_person
                ${(inactive) ? `where P.status='INACTIVO'` : `where P.status='ACTIVO'`}
                ${(id) ? ` and P.id_person='${id}'` : ''}
                ${(role) ? ` and P.id_role = ${role}` : ''}
                ${(email) ? ` and P.email = '${email}'` : ''}
                ${(user) ? ` and UA.nameUser COLLATE SQL_Latin1_General_CP1_CS_AS ='${user}'` : ''}
            `);
        return Person[0];
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetPersonGeneral = GetPersonGeneral;
/**
 * Obtiene los roles que desempeña una persona
 * @param {Object&lt;{ role: Object&lt;{ id_role:number, name:string}>| undefined, id_role: number| undefined }>} param0
 * @returns {Promise&lt;string | IRecordSet&lt;Role>>}
 */
const GetRoles = ({ id_role, role }) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        if (id_role &amp;&amp; role)
            throw (`Parametros erroneos, solo se puede consultar un solo paramatro a la vez`);
        let query = (id_role) ? `select * from Role where id_role = ${id_role}` : (role) ? `select * from Role where id_role = ${role.id_role} and name='${role.name}'` : 'select * from Role';
        const { recordset: Roles } = yield connection_1.pool1.request().query(query);
        return Roles;
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetRoles = GetRoles;
/**
 * Obtiene el indice siguiente de un servicio
 * @returns { Promise&lt;string | number>}
 */
const GetIndexService = () => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const { recordset } = yield connection_1.pool1.request().query(`select count(*) as idx from Service`);
        return recordset[0].idx + 1;
    }
    catch (error) {
        return ` ${error}`;
    }
});
exports.GetIndexService = GetIndexService;
/**
 * Obtiene los técnicos disponibles
 * @returns {Promise&lt;string | Person[]>}
 */
const GetDisponibleTechnical = () => __awaiter(void 0, void 0, void 0, function* () {
    const technicals = yield (0, exports.GetPersons)(1, true);
    if (typeof (technicals) === 'string')
        return `${technicals}`;
    const technicalsInService = yield (0, exports.GetTechnicalsInServiceActive)();
    if (typeof (technicalsInService) === 'string')
        return `${technicalsInService}`;
    const DisponibleTechnical = technicals.filter(t => { var _a; return t.id_person !== ((_a = technicalsInService.find(f => f.id_person === t.id_person)) === null || _a === void 0 ? void 0 : _a.id_person); });
    return DisponibleTechnical;
});
exports.GetDisponibleTechnical = GetDisponibleTechnical;
/**
 * Obtiene todos o un tipo de servicio
 * @param {Object&lt;{id_type: number| undefined, name: string| undefined}>} param0
 * @returns {Promise&lt; string| Array&lt;{id_Type: number, name: string}>>}
 */
const GetTypes = ({ id_type, name }) => __awaiter(void 0, void 0, void 0, function* () {
    const query = (id_type &amp;&amp; name) ? `select * from TypeService where id_type = ${id_type} and name = '${name}'`
        : (id_type) ? `select * from TypeService where id_type = ${id_type}`
            : (name) ? `select * from TypeService where name = '${name}'`
                : 'select * from TypeService';
    try {
        const { recordset: Types } = yield connection_1.pool1.request().query(query);
        return Types;
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetTypes = GetTypes;
/**
 * Obtiene los técnicos que estan en un servicio activo
 * @param {string | undefined} id_service  id del servicio
 * @returns {Promise&lt;string | IRecordSet&lt;Person>>}
 */
const GetTechnicalsInServiceActive = (id_service) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const { recordset: Technicals } = yield connection_1.pool1.request()
            .query(`
                    select TS.id_technical as id_person, P.id_enterprice,P.id_role,E.shortName as enterpriceShortName,P.name  as personName,P.lastname,P.email,P.password,P.phoneNumber,P.employeeNumber,P.status,UA.nameUser,TS.withOutFolio, S.id_service
                    from TechnicalService TS
                    left join Service S on TS.id_service = S.id_service
                    left join Person P on P.id_person=TS.id_technical
                    left join Enterprice E on E.id_enterprice= P.id_enterprice
                    left join UserAccess UA on UA.id_user= TS.id_service
                    where S.isActive = 'true' ${(id_service) ? `and S.id_service = '${id_service}' ` : ''}
                `);
        return Technicals;
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetTechnicalsInServiceActive = GetTechnicalsInServiceActive;
/**
 * Proceso que reorna un técnico si pertenece a un servicio activo
 * @param {string} id_technical id del técnico
 * @returns {Promise&lt;string | Person>}
 */
const ExistTechnicalInService = (id_technical) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const { recordset: Technical } = yield connection_1.pool1.request()
            .input('id_technical', mssql_1.TYPES.VarChar(40), id_technical)
            .query(`
                    select TS.id_technical as id_person, P.id_enterprice,P.id_role,E.shortName,P.name,P.lastname,P.phoneNumber,P.employeeNumber,P.status,UA.nameUser from TechnicalService TS
                    left join Service S on TS.id_service = S.id_service
                    left join Person P on P.id_person=TS.id_technical
                    left join Enterprice E on E.id_enterprice= P.id_enterprice
                    left join UserAccess UA on UA.id_user= TS.id_service
                    where S.isActive='true' and id_technical=@id_technical
                `);
        return Technical[0];
    }
    catch (error) {
        return `${error}`;
    }
});
exports.ExistTechnicalInService = ExistTechnicalInService;
/**
 * Proceso que retorna un servicio o todos los servios activos o inactivos
 * @param {Object&lt;{ service: Object&lt;{ service: Object&lt;{ id_service: string, selected: boolean| undefined}>| undefined }>| undefined}>} param0 si service = undefined: Retorna todos los servicios activos si manda el id solo regresa el servicio seleccionado, y si se selecciona selected regresa un servicio que ya no este activo.
 * @returns {Promise&lt;string| Array&lt;Service>>}
 */
const GetActiveServices = ({ service }) => __awaiter(void 0, void 0, void 0, function* () {
    const query = (service) ? `Select * from Service where id_service = '${service.id_service}' ${(service.selected) ? '' : ` and isActive = 'true'`} ` : `Select * from Service where isActive = 'true'`;
    try {
        const { recordset } = yield connection_1.pool1.request()
            .input('id_service', mssql_1.TYPES.VarChar(40), (service) ? service.selected : '')
            .query(query);
        return recordset;
    }
    catch (error) {
        return ` ${error}`;
    }
});
exports.GetActiveServices = GetActiveServices;
/**
 * Todos los técnicos en servicio
 * @param {string} id_technical id del técnico
 * @returns {Promise&lt;string | Service>}
 */
const GetTechnicalInService = (id_technical) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const { recordset: Technical } = yield connection_1.pool1.request()
            .input('id_technical', mssql_1.TYPES.VarChar(40), id_technical)
            .query(`
                    select S.*,TS.withOutFolio from TechnicalService TS
                    left join Service S on TS.id_service = S.id_service
                    left join Person P on P.id_person=TS.id_technical
                    left join Enterprice E on E.id_enterprice= P.id_enterprice
                    left join UserAccess UA on UA.id_user= TS.id_service
                    where S.isActive='true' and id_technical=@id_technical
                `);
        return Technical[0];
    }
    catch (error) {
        return `${error}`;
    }
});
exports.GetTechnicalInService = GetTechnicalInService;
/**
 * Actualiza la información de un servicio
 * @param { Object&lt;{id_service: string, prop: string, interno: boolean, selected: boolean| undefined}>} updateService
 * @returns{ Promise&lt;string | true | { service: Service, technicals: IRecordSet&lt;Person> } | { service: Service, technicals: never[] }>}
 */
const UpdateService = ({ id_service, prop, interno, selected }) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), id_service)
        .query(`UPDATE Service set ${prop} where id_service = @id_service`)
        .then(() => __awaiter(void 0, void 0, void 0, function* () {
        if (interno) {
            return true;
        }
        else {
            // const service = await GetActiveService(id_service, selected);
            const service = yield (0, exports.GetActiveServices)({ service: { id_service, selected } });
            if (typeof (service) === 'string')
                throw new Error(`${service}`);
            // if (service === undefined) throw new Error("Servicio no existe");
            if (service.length === 0)
                throw new Error("Servicio no existe");
            if (selected === undefined) {
                const technicals = yield (0, exports.GetTechnicalsInServiceActive)(id_service);
                if (typeof (technicals) === 'string')
                    throw new Error(`${technicals}`);
                return { service: service[0], technicals };
            }
            return { service: service[0], technicals: [] };
        }
    }))
        .catch(err => { return ` ${err}`; });
});
exports.UpdateService = UpdateService;
/**
 * Actualiza la información de un técnico
 * @param {Object&lt;{ id_service: string, id_person: string, prop: string}>} updateTechnical
 * @returns {Promise&lt;string | boolean>}
 */
const UpdateTechnical = ({ id_service, id_person, prop }) => __awaiter(void 0, void 0, void 0, function* () {
    return yield connection_1.pool1.request()
        .input('id_service', mssql_1.TYPES.VarChar(40), id_service)
        .input('id_person', mssql_1.TYPES.VarChar(40), id_person)
        .query(`UPDATE TechnicalService SET ${prop} WHERE id_service = @id_service AND id_technical = @id_person`)
        .then(() => __awaiter(void 0, void 0, void 0, function* () { return true; }))
        .catch(err => { return `${err}`; });
});
exports.UpdateTechnical = UpdateTechnical;
/**
 * Actualiza la informacón de una persona
 * @param {Object&lt;{ id_person:string , prop: string| undefined, data: updatePersonData | undefined }>} updatePersonProps
 * @returns {Promise&lt;string | boolean>}
 */
const UpdatePerson = ({ id_person, prop, data }) => __awaiter(void 0, void 0, void 0, function* () {
    if (id_person &amp;&amp; prop &amp;&amp; data)
        return `formato de propiedades invalidas`;
    if (id_person &amp;&amp; data) {
        const { email, employeeNumber, lastname, password, personName, phoneNumber } = data;
        return yield connection_1.pool1.request()
            .input('id_person', mssql_1.TYPES.VarChar(40), id_person)
            .input('name', mssql_1.TYPES.VarChar(30), personName)
            .input('lastname', mssql_1.TYPES.VarChar(50), lastname)
            .input('email', mssql_1.TYPES.VarChar(50), email)
            .input('password', mssql_1.TYPES.Text, password)
            .input('phoneNumber', mssql_1.TYPES.VarChar(10), phoneNumber)
            .input('employeeNumber', mssql_1.TYPES.VarChar(20), employeeNumber)
            .query(`
                    update Person set 
                        name = @name,
                        lastname = @lastname,
                        email = ${email !== '' ? '@email' : 'NULL'},
                        phoneNumber = ${phoneNumber !== '' ? '@phoneNumber' : 'NULL'},
                        password = @password,
                        employeeNumber = @employeeNumber
                    where id_person = @id_person
                `)
            .then(() => __awaiter(void 0, void 0, void 0, function* () { return true; }))
            .catch(err => `${err}`);
    }
    if (id_person &amp;&amp; prop) {
        return yield connection_1.pool1.request()
            .input('id_person', mssql_1.TYPES.VarChar(40), id_person)
            .query(`UPDATE Person set ${prop} where id_person = @id_person`)
            .then(() => __awaiter(void 0, void 0, void 0, function* () { return true; }))
            .catch(err => { return `${err}`; });
    }
    return `Ningun caso sontemplado`;
});
exports.UpdatePerson = UpdatePerson;
/**
 * Obtiene todos los servicios ya sea por técnico ( Que el técnico pertenezca al servicio), por cuenta ( que la cuenta halla sido asignada al servicio) y todos los registrados
 * @param {Object&lt;{start: string, end: string, technical: string | undefined, account: string | undefined}>} param0
 * @returns {Promise&lt;string | IRecordSet&lt;respGetServiceFiltered>>}
 */
const GetServices = ({ end, start, account, technical }) => __awaiter(void 0, void 0, void 0, function* () {
    if (technical) {
        const person = yield (0, exports.GetPersonGeneral)({ id: technical });
        if (typeof person === 'string')
            return person;
        if (person === undefined)
            return `técnico no existe`;
        const { recordset } = yield connection_1.pool1.request()
            .input('id_technical', mssql_1.TYPES.VarChar(40), person.id_person)
            .query(`
                    SELECT S.id_service,S.folio,S.entryDate,S.exitDate,S.accountMW,S.isActive,S.digital,S.nameAccount,S.isDelivered FROM TechnicalService TS 
                    LEFT JOIN Service S ON S.id_service=TS.id_service 
                    WHERE
                    id_technical=@id_technical AND 
                    entryDate between '${start} 00:00:00' AND '${end} 23:59:59'
                    order by entryDate desc
                `);
        return recordset;
    }
    const { recordset } = yield connection_1.pool1.request()
        .query(`
                SELECT S.id_service,folio,entryDate,exitDate,accountMW,isActive,digital,nameAccount,B.technicals FROM Service S
                LEFT JOIN Binnacle B ON B.id_service=S.id_service 
                WHERE 
                entryDate BETWEEN '${start} 00:00:00' AND '${end} 23:59:59'
                ${account ? `AND accountMW = '${account}'` : ''}
                order by entryDate desc
            `);
    return recordset;
});
exports.GetServices = GetServices;
/**
 * Obtiene toda la inforción de un servicio culminado por id
 * @param {Object&lt;{id_service: string}>} param0
 * @returns {Promise&lt;string | { binnacle: IRecordSet&lt;Binnacle>, comments: IRecordSet&lt;Comment>}>}
 */
const GetService = ({ id_service }) => __awaiter(void 0, void 0, void 0, function* () {
    try {
        const { recordset: binnacle } = yield connection_1.pool1.request()
            .input('id_service', mssql_1.TYPES.VarChar(40), id_service)
            .query(`SELECT * FROM Binnacle WHERE id_service = @id_service`);
        const { recordset: comments } = yield connection_1.pool1.request()
            .input('id_service', mssql_1.TYPES.VarChar(40), id_service)
            .query(`SELECT * FROM Comment WHERE id_service= @id_service`);
        return { binnacle, comments };
    }
    catch (error) {
        return ` ${error}`;
    }
});
exports.GetService = GetService;
//# sourceMappingURL=querysTecnicos.js.map</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"ADMIN_CONTROLLER","link":"<a href=\"module-ADMIN_CONTROLLER.html\">ADMIN_CONTROLLER</a>"},{"title":"API-MW","link":"<a href=\"module-API-MW.html\">API-MW</a>"},{"title":"module:API-MW~apiMW","link":"<a href=\"module-API-MW.html#~apiMW\">module:API-MW~apiMW &rtrif; undefined</a>"},{"title":"AUTH_CONTROLLER","link":"<a href=\"module-AUTH_CONTROLLER.html\">AUTH_CONTROLLER</a>"},{"title":"CONSULTAS_BD_TECNICOS","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html\">CONSULTAS_BD_TECNICOS</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~AddBinnacle","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~AddBinnacle\">module:CONSULTAS_BD_TECNICOS~AddBinnacle &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~AddComment","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~AddComment\">module:CONSULTAS_BD_TECNICOS~AddComment &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~AddPerson","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~AddPerson\">module:CONSULTAS_BD_TECNICOS~AddPerson &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~addPersonBD","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~addPersonBD\">module:CONSULTAS_BD_TECNICOS~addPersonBD &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~AddService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~AddService\">module:CONSULTAS_BD_TECNICOS~AddService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~AddTechnicalService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~AddTechnicalService\">module:CONSULTAS_BD_TECNICOS~AddTechnicalService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~DeleteTechnicaltoService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~DeleteTechnicaltoService\">module:CONSULTAS_BD_TECNICOS~DeleteTechnicaltoService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~ExistEployeeNumber","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~ExistEployeeNumber\">module:CONSULTAS_BD_TECNICOS~ExistEployeeNumber &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~ExistTechnicalInService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~ExistTechnicalInService\">module:CONSULTAS_BD_TECNICOS~ExistTechnicalInService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetActiveServices","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetActiveServices\">module:CONSULTAS_BD_TECNICOS~GetActiveServices &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetDisponibleTechnical","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetDisponibleTechnical\">module:CONSULTAS_BD_TECNICOS~GetDisponibleTechnical &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetEnterprices","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetEnterprices\">module:CONSULTAS_BD_TECNICOS~GetEnterprices &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetIndexService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetIndexService\">module:CONSULTAS_BD_TECNICOS~GetIndexService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetPersonGeneral","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetPersonGeneral\">module:CONSULTAS_BD_TECNICOS~GetPersonGeneral &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetPersons","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetPersons\">module:CONSULTAS_BD_TECNICOS~GetPersons &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetRoles","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetRoles\">module:CONSULTAS_BD_TECNICOS~GetRoles &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetService\">module:CONSULTAS_BD_TECNICOS~GetService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetServices","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetServices\">module:CONSULTAS_BD_TECNICOS~GetServices &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetTechnicalInService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetTechnicalInService\">module:CONSULTAS_BD_TECNICOS~GetTechnicalInService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetTechnicalsInServiceActive","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetTechnicalsInServiceActive\">module:CONSULTAS_BD_TECNICOS~GetTechnicalsInServiceActive &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~GetTypes","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~GetTypes\">module:CONSULTAS_BD_TECNICOS~GetTypes &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~UpdatePerson","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~UpdatePerson\">module:CONSULTAS_BD_TECNICOS~UpdatePerson &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~UpdateService","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~UpdateService\">module:CONSULTAS_BD_TECNICOS~UpdateService &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~UpdateTechnical","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~UpdateTechnical\">module:CONSULTAS_BD_TECNICOS~UpdateTechnical &rtrif; undefined</a>"},{"title":"module:CONSULTAS_BD_TECNICOS~UserAccess","link":"<a href=\"module-CONSULTAS_BD_TECNICOS.html#~UserAccess\">module:CONSULTAS_BD_TECNICOS~UserAccess &rtrif; undefined</a>"},{"title":"CONSULTAS_SISTEMA_MONITORING-WORKS","link":"<a href=\"module-CONSULTAS_SISTEMA_MONITORING-WORKS.html\">CONSULTAS_SISTEMA_MONITORING-WORKS</a>"},{"title":"ERROR_CONTROLLER","link":"<a href=\"module-ERROR_CONTROLLER.html\">ERROR_CONTROLLER</a>"},{"title":"FILES","link":"<a href=\"module-FILES.html\">FILES</a>"},{"title":"module:FILES~createFolder","link":"<a href=\"module-FILES.html#~createFolder\">module:FILES~createFolder &rtrif; undefined</a>"},{"title":"module:FILES~deleteDirectory","link":"<a href=\"module-FILES.html#~deleteDirectory\">module:FILES~deleteDirectory &rtrif; undefined</a>"},{"title":"module:FILES~deleteFile","link":"<a href=\"module-FILES.html#~deleteFile\">module:FILES~deleteFile &rtrif; undefined</a>"},{"title":"module:FILES~existDirectory","link":"<a href=\"module-FILES.html#~existDirectory\">module:FILES~existDirectory &rtrif; undefined</a>"},{"title":"module:FILES~getFiles","link":"<a href=\"module-FILES.html#~getFiles\">module:FILES~getFiles &rtrif; undefined</a>"},{"title":"module:FILES~upLoadFile","link":"<a href=\"module-FILES.html#~upLoadFile\">module:FILES~upLoadFile &rtrif; undefined</a>"},{"title":"FILES_CONTROLLER","link":"<a href=\"module-FILES_CONTROLLER.html\">FILES_CONTROLLER</a>"},{"title":"FUNCTIONS","link":"<a href=\"module-FUNCTIONS.html\">FUNCTIONS</a>"},{"title":"module:FUNCTIONS~DecriptRot39","link":"<a href=\"module-FUNCTIONS.html#~DecriptRot39\">module:FUNCTIONS~DecriptRot39 &rtrif; undefined</a>"},{"title":"module:FUNCTIONS~EncriptRot39","link":"<a href=\"module-FUNCTIONS.html#~EncriptRot39\">module:FUNCTIONS~EncriptRot39 &rtrif; undefined</a>"},{"title":"module:FUNCTIONS~esLetra","link":"<a href=\"module-FUNCTIONS.html#~esLetra\">module:FUNCTIONS~esLetra &rtrif; undefined</a>"},{"title":"module:FUNCTIONS~esNumero","link":"<a href=\"module-FUNCTIONS.html#~esNumero\">module:FUNCTIONS~esNumero &rtrif; undefined</a>"},{"title":"module:FUNCTIONS~getDate","link":"<a href=\"module-FUNCTIONS.html#~getDate\">module:FUNCTIONS~getDate &rtrif; undefined</a>"},{"title":"module:FUNCTIONS~getEnterpriceOfTechnicals","link":"<a href=\"module-FUNCTIONS.html#~getEnterpriceOfTechnicals\">module:FUNCTIONS~getEnterpriceOfTechnicals &rtrif; undefined</a>"},{"title":"module:FUNCTIONS~modDate","link":"<a href=\"module-FUNCTIONS.html#~modDate\">module:FUNCTIONS~modDate &rtrif; undefined</a>"},{"title":"GENERAR_JWT","link":"<a href=\"module-GENERAR_JWT.html\">GENERAR_JWT</a>"},{"title":"module:GENERAR_JWT~decodeJWT","link":"<a href=\"module-GENERAR_JWT.html#~decodeJWT\">module:GENERAR_JWT~decodeJWT &rtrif; undefined</a>"},{"title":"module:GENERAR_JWT~generarJWT","link":"<a href=\"module-GENERAR_JWT.html#~generarJWT\">module:GENERAR_JWT~generarJWT &rtrif; undefined</a>"},{"title":"HELPERS_DB_VALIDACIONES","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html\">HELPERS_DB_VALIDACIONES</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~existEmail","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~existEmail\">module:HELPERS_DB_VALIDACIONES~existEmail &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~existEnterprice","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~existEnterprice\">module:HELPERS_DB_VALIDACIONES~existEnterprice &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~ExistPersonInDB","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~ExistPersonInDB\">module:HELPERS_DB_VALIDACIONES~ExistPersonInDB &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~existRole","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~existRole\">module:HELPERS_DB_VALIDACIONES~existRole &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~existRoleinDB","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~existRoleinDB\">module:HELPERS_DB_VALIDACIONES~existRoleinDB &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~existTechnicals","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~existTechnicals\">module:HELPERS_DB_VALIDACIONES~existTechnicals &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~existTypeService","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~existTypeService\">module:HELPERS_DB_VALIDACIONES~existTypeService &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~isDate","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~isDate\">module:HELPERS_DB_VALIDACIONES~isDate &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~validateOptionUpdateEnterprice","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~validateOptionUpdateEnterprice\">module:HELPERS_DB_VALIDACIONES~validateOptionUpdateEnterprice &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~validateOptionUpdatePerson","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~validateOptionUpdatePerson\">module:HELPERS_DB_VALIDACIONES~validateOptionUpdatePerson &rtrif; undefined</a>"},{"title":"module:HELPERS_DB_VALIDACIONES~validEnterprice","link":"<a href=\"module-HELPERS_DB_VALIDACIONES.html#~validEnterprice\">module:HELPERS_DB_VALIDACIONES~validEnterprice &rtrif; undefined</a>"},{"title":"Server","link":"<a href=\"Server.html\">Server</a>"},{"title":"Server#connectDB","link":"<a href=\"Server.html#connectDB\">Server &rtrif; connectDB</a>"},{"title":"Server#listen","link":"<a href=\"Server.html#listen\">Server &rtrif; listen</a>"},{"title":"Server#middlewares","link":"<a href=\"Server.html#middlewares\">Server &rtrif; middlewares</a>"},{"title":"Server#routes","link":"<a href=\"Server.html#routes\">Server &rtrif; routes</a>"},{"title":"Task","link":"<a href=\"Task.html\">Task</a>"},{"title":"Task#add","link":"<a href=\"Task.html#add\">Task &rtrif; add</a>"},{"title":"Task#delete","link":"<a href=\"Task.html#delete\">Task &rtrif; delete</a>"},{"title":"Task#deleteTaskifNotExist","link":"<a href=\"Task.html#deleteTaskifNotExist\">Task &rtrif; deleteTaskifNotExist</a>"},{"title":"Task#getCrons","link":"<a href=\"Task.html#getCrons\">Task &rtrif; getCrons</a>"},{"title":"Task#getTask","link":"<a href=\"Task.html#getTask\">Task &rtrif; getTask</a>"},{"title":"Task#stop","link":"<a href=\"Task.html#stop\">Task &rtrif; stop</a>"},{"title":"Task#update","link":"<a href=\"Task.html#update\">Task &rtrif; update</a>"},{"title":"addService","link":"<a href=\"global.html\">addService</a>"},{"title":"Body","link":"<a href=\"global.html#Body\">Body</a>"},{"title":"date","link":"<a href=\"global.html#date\">date</a>"},{"title":"FormatDate","link":"<a href=\"global.html#FormatDate\">FormatDate</a>"},{"title":"getAccountsMW","link":"<a href=\"global.html\">getAccountsMW</a>"},{"title":"getActiveServices","link":"<a href=\"global.html\">getActiveServices</a>"},{"title":"getDisponibleTechnicals","link":"<a href=\"global.html\">getDisponibleTechnicals</a>"},{"title":"getEvents","link":"<a href=\"global.html\">getEvents</a>"},{"title":"getInServiceTechnicals","link":"<a href=\"global.html\">getInServiceTechnicals</a>"},{"title":"getPersons","link":"<a href=\"global.html\">getPersons</a>"},{"title":"getServiceDetails","link":"<a href=\"global.html\">getServiceDetails</a>"},{"title":"getServices","link":"<a href=\"global.html\">getServices</a>"},{"title":"getTask","link":"<a href=\"global.html\">getTask</a>"},{"title":"getVersionApp","link":"<a href=\"global.html\">getVersionApp</a>"},{"title":"modTechnicalToAService","link":"<a href=\"global.html\">modTechnicalToAService</a>"},{"title":"PropsAddBinnacle","link":"<a href=\"global.html#PropsAddBinnacle\">PropsAddBinnacle</a>"},{"title":"PropsAddPerson","link":"<a href=\"global.html#PropsAddPerson\">PropsAddPerson</a>"},{"title":"PropsAddService","link":"<a href=\"global.html#PropsAddService\">PropsAddService</a>"},{"title":"RespUserAccess","link":"<a href=\"global.html#RespUserAccess\">RespUserAccess</a>"},{"title":"time","link":"<a href=\"global.html#time\">time</a>"},{"title":"updateService","link":"<a href=\"global.html\">updateService</a>"},{"title":"updateTask","link":"<a href=\"global.html\">updateTask</a>"},{"title":"validarCampos","link":"<a href=\"global.html#validarCampos\">validarCampos</a>"},{"title":"validarJWT","link":"<a href=\"global.html#validarJWT\">validarJWT</a>"},{"title":"verifyEventsService","link":"<a href=\"global.html\">verifyEventsService</a>"},{"title":"verifyPassword","link":"<a href=\"global.html\">verifyPassword</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    


  </body>

</html>
